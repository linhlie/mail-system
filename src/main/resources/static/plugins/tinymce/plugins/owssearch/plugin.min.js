!function(){"use strict";var r=function(e){var t=e,n=function(){return t};return{get:n,set:function(e){t=e},clone:function(){return r(n())}}},e=tinymce.util.Tools.resolve("tinymce.PluginManager"),g=tinymce.util.Tools.resolve("tinymce.util.Tools");function m(e){return e&&1===e.nodeType&&"false"===e.contentEditable}var u={findAndReplaceDOMText:function(e,t,n,r,a){var o,i,v,f,g,h,d=[],s=0;function c(e,t){if(t=t||0,!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");var n=e.index;if(0<t){var r=e[t];if(!r)throw new Error("Invalid capture group");n+=e[0].indexOf(r),e[0]=r}return[n,n+e[0].length,[e[0]]]}if(v=t.ownerDocument,f=a.getBlockElements(),g=a.getWhiteSpaceElements(),h=a.getShortEndedElements(),i=function e(t){var n;if(3===t.nodeType)return t.data;if(g[t.nodeName]&&!f[t.nodeName])return"";if(n="",m(t))return"\n";if((f[t.nodeName]||h[t.nodeName])&&(n+="\n"),t=t.firstChild)for(;n+=e(t),t=t.nextSibling;);return n}(t)){if(e.global)for(;o=e.exec(i);)d.push(c(o,r));else o=i.match(e),d.push(c(o,r));return d.length&&(s=d.length,function(e,t,n){var r,a,o,i,d=[],s=0,c=e,l=t.shift(),u=0;e:for(;;){if((f[c.nodeName]||h[c.nodeName]||m(c))&&s++,3===c.nodeType&&(!a&&c.length+s>=l[1]?(a=c,i=l[1]-s):r&&d.push(c),!r&&c.length+s>l[0]&&(r=c,o=l[0]-s),s+=c.length),r&&a){if(c=n({startNode:r,startNodeIndex:o,endNode:a,endNodeIndex:i,innerNodes:d,match:l[2],matchIndex:u}),s-=a.length-i,a=r=null,d=[],u++,!(l=t.shift()))break}else if(g[c.nodeName]&&!f[c.nodeName]||!c.firstChild){if(c.nextSibling){c=c.nextSibling;continue}}else if(!m(c)){c=c.firstChild;continue}for(;;){if(c.nextSibling){c=c.nextSibling;break}if(c.parentNode===e)break e;c=c.parentNode}}}(t,d,function(e){var p;if("function"!=typeof e){var r=e.nodeType?e:v.createElement(e);p=function(e,t){var n=r.cloneNode(!1);return n.setAttribute("data-mce-index",t),e&&n.appendChild(v.createTextNode(e)),n}}else p=e;return function(e){var t,n,r,a=e.startNode,o=e.endNode,i=e.matchIndex;if(a===o){var d=a;r=d.parentNode,0<e.startNodeIndex&&(t=v.createTextNode(d.data.substring(0,e.startNodeIndex)),r.insertBefore(t,d));var s=p(e.match[0],i);return r.insertBefore(s,d),e.endNodeIndex<d.length&&(n=v.createTextNode(d.data.substring(e.endNodeIndex)),r.insertBefore(n,d)),d.parentNode.removeChild(d),s}t=v.createTextNode(a.data.substring(0,e.startNodeIndex)),n=v.createTextNode(o.data.substring(e.endNodeIndex));for(var c=p(a.data.substring(e.startNodeIndex),i),l=[],u=0,f=e.innerNodes.length;u<f;++u){var g=e.innerNodes[u],h=p(g.data,i);g.parentNode.replaceChild(h,g),l.push(h)}var m=p(o.data.substring(0,e.endNodeIndex),i);return(r=a.parentNode).insertBefore(t,a),r.insertBefore(c,a),r.removeChild(a),(r=o.parentNode).insertBefore(m,o),r.insertBefore(n,o),r.removeChild(o),m}}(n))),s}}},h=function(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t},p=function(e){var t=e.parentNode;e.firstChild&&t.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)},i=function(e,t){var n,r=[];if((n=g.toArray(e.getBody().getElementsByTagName("span"))).length)for(var a=0;a<n.length;a++){var o=h(n[a]);null!==o&&o.length&&o===t.toString()&&r.push(n[a])}return r},f=function(e,t,n){var r=t.get(),a=e.dom;(n=!1!==n)?r++:r--,a.removeClass(i(e,t.get()),"mce-match-marker-selected");var o=i(e,r);return o.length?(a.addClass(i(e,r),"mce-match-marker-selected"),e.selection.scrollIntoView(o[0]),r):-1},v=function(e,t){var n=t.parentNode;e.remove(t),e.isEmpty(n)&&e.remove(n)},x=function(e,t){var n=f(e,t,!0);-1!==n&&t.set(n)},N=function(e,t){var n=f(e,t,!1);-1!==n&&t.set(n)},b=function(e){var t=h(e);return null!==t&&0<t.length},y=function(e,t,n){var r,a,o,i;for(a=g.toArray(e.getBody().getElementsByTagName("span")),r=0;r<a.length;r++){var d=h(a[r]);null!==d&&d.length&&(d===t.get().toString()&&(o||(o=a[r].firstChild),i=a[r].firstChild),p(a[r]))}if(o&&i){var s=e.dom.createRng();return s.setStart(o,0),s.setEnd(i,i.data.length),!1!==n&&e.selection.setRng(s),s}},w=function(e,t){return 0<i(e,t.get()+1).length},C=function(e,t){return 0<i(e,t.get()-1).length},k={done:y,find:function(e,t,n,r,a){n=(n=n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\s/g,"\\s"),n=a?"\\b"+n+"\\b":n;var o,i,d,s,c,l=(o=e,i=t,d=new RegExp(n,r?"g":"gi"),(c=o.dom.create("span",{"data-mce-bogus":1})).className="mce-match-marker",s=o.getBody(),y(o,i,!1),u.findAndReplaceDOMText(d,s,c,!1,o.schema));return l&&(t.set(-1),t.set(f(e,t,!0))),l},next:x,prev:N,replace:function(e,t,n,r,a){var o,i,d,s,c,l,u=t.get();for(r=!1!==r,d=e.getBody(),i=g.grep(g.toArray(d.getElementsByTagName("span")),b),o=0;o<i.length;o++){var f=h(i[o]);if(s=c=parseInt(f,10),a||s===t.get()){for(n.length?(i[o].firstChild.nodeValue=n,p(i[o])):v(e.dom,i[o]);i[++o];){if((s=parseInt(h(i[o]),10))!==c){o--;break}v(e.dom,i[o])}r&&u--}else c>t.get()&&i[o].setAttribute("data-mce-index",c-1)}return t.set(u),r?(l=w(e,t),x(e,t)):(l=C(e,t),N(e,t)),!a&&l},hasNext:w,hasPrev:C},n=function(r,a){return{done:function(e){return k.done(r,a,e)},find:function(e,t,n){return k.find(r,a,e,t,n)},next:function(){return k.next(r,a)},prev:function(){return k.prev(r,a)},replace:function(e,t,n){return k.replace(r,a,e,t,n)}}},a=function(o,i){var e,d={};function s(){l.statusbar.find("#next").disabled(!1===k.hasNext(o,i)),l.statusbar.find("#prev").disabled(!1===k.hasPrev(o,i))}function c(){o.windowManager.alert("Could not find the specified string.",function(){l.find("#find")[0].focus()})}o.undoManager.add(),e=g.trim(o.selection.getContent({format:"text"}));var l=o.windowManager.open({layout:"flex",pack:"center",align:"center",onClose:function(){o.focus(),k.done(o,i),o.undoManager.add()},onSubmit:function(e){var t,n,r,a;return e.preventDefault(),n=l.find("#case").checked(),a=l.find("#words").checked(),(r=l.find("#find").value()).length?d.text===r&&d.caseState===n&&d.wholeWord===a?k.hasNext(o,i)?(k.next(o,i),void s()):void c():((t=k.find(o,i,r,n,a))||c(),l.statusbar.items().slice(1).disabled(0===t),s(),void(d={text:r,caseState:n,wholeWord:a})):(k.done(o,i,!1),void l.statusbar.items().slice(1).disabled(!0))},buttons:[{text:"Find",subtype:"primary",onclick:function(){l.submit()}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){k.prev(o,i),s()}},{text:"Next",name:"next",disabled:!0,onclick:function(){k.next(o,i),s()}}],title:"Find",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:e},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}})},o=function(e,t){e.addCommand("OwsSearch",function(){a(e,t)})},d=function(e,t){return function(){a(e,t)}},s=function(e,t){e.addMenuItem("owssearch",{text:"Find",shortcut:"Meta+F",onclick:d(e,t),separator:"before",context:"edit"}),e.addButton("owssearch",{tooltip:"Find",onclick:d(e,t)}),e.shortcuts.add("Meta+F","",d(e,t))};e.add("owssearch",function(e){var t=r(-1);return o(e,t),s(e,t),n(e,t)})}();